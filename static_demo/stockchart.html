<!DOCTYPE html>
<html>
<head>
   <title>Highstock twitter graph</title>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="./highstock/js/highstock.js"></script>
<script src="./highstock/js/modules/exporting.js"></script>
<script>

//Need to convert all tweet times to unix time
function parseJSON() {
    var points_map = {};
    var points_list = [];
    var time_points = [];
    $.ajax({
        type: 'GET',
        url: 'all.json',
        dataType: 'json',
        data: {},
        async: false,
        success: function(data) {
            $.each(data, function(key, val) {
                var tag = key;
                //alert(tag);
                for (var i in val) {
                    for (var result in data[key][i]['results']) {
                        //alert(data[key][i]['results'][result]['created_at']);
                        //alert(Date.parse(data[key][i]['results'][result]['created_at']));
                        //alert(string(Date.parse(data[key][i]['results'][result]['created_at'])));
                        //points.push( [ Date.parse(data[key][i]['results'][result]['created_at']), 1 ] );
                        time_points.push(Date.parse(data[key][i]['results'][result]['created_at']));
                    }
                }
            }); 
        }
    });
    //alert(Math.max.apply(Math, time_points));
    //alert(Math.min.apply(Math, time_points));


    var min = Math.min.apply(Math, time_points);
    var max = Math.max.apply(Math, time_points);
    var num_bins = 100;
    var bin_size = Math.floor((max - min) / num_bins );

    for(var i=0 ; i<num_bins ; i++) { points_map[i] = 0; }
    
    for(var i=0 ; i<time_points.length ; i++) {
        points_map[ Math.floor( ( time_points[i] - min ) / bin_size ) ] += 1;
    }

    $.each(points_map, function(k,v) {
        time = min + bin_size*k;
        points_list.push([time,v]);
    });    
    
    return points_list;
};


function displayChart(data) {
    $(function() {
        $('#container').highcharts('StockChart', {
            chart: {
                alignTicks: false
            },

            xAxis: {
                type: 'datetime',
                tickInterval: 1000*3600*24,
                dateTimeLabelFormats: {
                    hour: '%H:%M',
                    day: '%m-%d-%y'
                }
            }, 

            rangeSelector: {
                selected: 1
            },

            series: [{
                type: 'column',
                name: 'Tweet Activity',
                data: data,
                dataGrouping: {
                    units: [[
                            'hour',
                            [1, 2, 3, 4, 6, 12, 24]
                            ]]
                }
            }]
        });
    });
};


var data = parseJSON();
displayChart(data);

</script>
</head>

<body>
    <div id="container" style="height:500px">

    </div>

</body>
</html>

<script>
/*
var hash_data = {}
for(var i=0 ; i<data.length ; i++) {
    hash_data[data[i]] = 0;
}

for(var i=0 ; i<data.length ; i++) {
    hash_data[data[i]] += 1;
}

var tuples = [];
for (var key in hash_data) tuples.push([key, hash_data[key]]);

tuples.sort(function(a, b) {
    a = a[1];
    b = b[1];

    return a < b ? -1 : (a > b ? 1 : 0);
});

for (var i = 0; i < tuples.length; i++) {
    var key = tuples[i][0];
    var value = tuples[i][1];
    document.write(key + ' : ' + value + '<br>');
}
*/
</script>
